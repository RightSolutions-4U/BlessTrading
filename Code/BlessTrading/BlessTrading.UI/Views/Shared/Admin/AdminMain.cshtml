@{
    Layout = null;
}
@using BlessTrading.Common.Models
@model Product
@using System.Web.Helpers;
@using GridMvc;

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin - Bless Trading</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    @*<script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js">*@
    @*</script>*@

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script>
        function PopCategories() {
            var URL = '@ViewBag.env' + '/api/Products/GetCategories';
            $.ajax({
                url: URL,
                type: 'GET',
                success: function (result) {
                    var markup = "<option value='x'>Select Category</option>";
                    var i;
                    for (i = 0; i < result.length; i++) {
                        markup += "<option value=" + JSON.stringify(result[i].recId) + ">" + JSON.stringify(result[i].catName) + "</option>";
                    }
                    $("#lstCategory").html(markup).show();
                },
                error: function (xhr, status, error) {
                    var err = eval("(" + xhr.responseText + ")");
                    alert(err.Message);
                }
            });
        }

        $(document).ready(function () {
            PopCategories();
@*            $('#tblproduct').dataTable({
                "bPaginate": true,
                "bFilter": false,
                "bInfo": false
            });*@
        });

        function hideme(name) {
            //var x = document.getElementById(name);

            if (name == 'defaultdiv') {
@*                var a = document.getElementById('VendorUpdate');
                a.style.display = "none";
*@              var x = document.getElementById('addproduct');
                x.style.display = "none";
                var y = document.getElementById('editproduct');
                y.style.display = "none";
                var z = document.getElementById('defaultdiv');
                z.style.display = "block";
                var c = document.getElementById('catdiv');
                c.style.display = "block";
                @*var b = document.getElementById('VendorOrders');
                b.style.display = "none";*@

            }
            else if (name == 'addproduct') {
                var c = document.getElementById('catdiv');
                c.style.display = "none";
@*                var a = document.getElementById('VendorUpdate');
                a.style.display = "none";
*@                var x = document.getElementById('defaultdiv');
                x.style.display = "none";
                var y = document.getElementById('editproduct');
                y.style.display = "none";
                var z = document.getElementById('addproduct');
                z.style.display = "block";
                @*var b = document.getElementById('VendorOrders');
                b.style.display = "none";*@
            }
            else if (name == 'editproduct') {
                var c = document.getElementById('catdiv');
                c.style.display = "none";
@*                var a = document.getElementById('VendorUpdate');
                a.style.display = "none";
*@                var x = document.getElementById('defaultdiv');
                x.style.display = "none";
                var y = document.getElementById('editproduct');
                y.style.display = "block";
                var z = document.getElementById('addproduct');
                z.style.display = "none";
@*                var b = document.getElementById('VendorOrders');
                b.style.display = "none";*@
            }
            else if (name == 'VendorOrders') {
                var c = document.getElementById('catdiv');
                c.style.display = "none";
@*                var a = document.getElementById('VendorUpdate');
                a.style.display = "none";
*@                var x = document.getElementById('defaultdiv');
                x.style.display = "none";
                var y = document.getElementById('editproduct');
                y.style.display = "none";
                var z = document.getElementById('addproduct');
                z.style.display = "none";
@*                var b = document.getElementById('VendorOrders');
                b.style.display = "block";
*@            }


        }
    </script>
    <style>
        /* Remove the navbar's default margin-bottom and rounded borders */
        .navbar {
            margin-bottom: 0;
            border-radius: 0;
        }

        /* Set height of the grid so .sidenav can be 100% (adjust as needed) */
        .row.content {
            height: 450px
        }

        /* Set gray background color and 100% height */
        .sidenav {
            padding-top: 20px;
            background-color: #f1f1f1;
            height: 100%;
        }

        /* Set black background color, white text and some padding */
        footer {
            background-color: #555;
            color: white;
            padding: 15px;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Bless Trading</a>
            </div>
        </div>
    </nav>
    
    <script>

        function getproducts() {
            var catid = $("#lstCategory").val();
            var path = window.location.origin;
            var URL = '@ViewBag.env' + '/api/Products/GetProductsByCat?';

            $.ajax({
                url: URL,
                type: 'GET',
                data: { CatId: catid },
                success: function (result) {

                    var tbl = document.getElementById("tblproduct");
                    for (var i = 1, row; row = tbl.rows[i]; i++) {
                        tbl.deleteRow(i);
                    }
                    var tableProd = $('#tblproduct tbody');

                    $.each(result, function (i, item) {
                        tableProd.append('<tr valign="middle"><td align="center">' + item.name + '</td><td>' + item.price + '</td><td>' + item.discount + '</td><td align="center"><img src=' + path + '/ProductImages/' + item.seoFilename + ' height = "75" width = "75" ></td><td align="center"><img src=' + path + '/images/editicon.png height = "20" width = "20" onclick="GetProduct(' + item.id + ');"  ></td><td align="center"><img src=' + path + '/images/delicon.png height = "20" width = "20" onclick="delprod(' + item.id + ');" ></td></tr>');
                    })
                },
                error:
                    function (result) {
                        var tbl = document.getElementById("tblproduct");
                        for (var i = 0, row; row = tbl.rows[i]; i++) {
                            tbl.deleteRow(0);
                        }
                        var tableProd = $('#tblproduct tbody');

                        var tableProd = $('#tblproduct tbody');
                        tableProd.append('<tr><td align="center" colspan="6" >No product available</td></tr>');
                        alert("error : " + result.responseText);
                    }
            });
        }
    </script>
    <div class="container-fluid text-center">
        <div class="row content">
            <div class="col-sm-2 sidenav">
                <p class="font-weight-bold"><a href="#">Categories</a></p>
                <p class="font-weight-bold"><a href="#" onclick="PopCategories();">Products</a></p>
                <p class="font-weight-bold"><a href="#">Order Management</a></p>
            </div>

            <div class="col-sm-8 text-left">
                <h1>Welcome back @ViewBag.UserId</h1>
                <hr />
                <div class="container">
                    <div class="col-sm-6 text-left" id="catdiv">
                        <select class="form-control" name="lstCategory" id="lstCategory" onchange="getproducts();">
                            <option>Select Category</option>";
                        </select>
                        <br />
                    </div>
                    <div id="defaultdiv" class="col-sm-10 text-left">
                        <table id="tblproduct" class="table table-striped table-bordered table-sm" cellspacing="0"
                               width="80%">
                            <thead>
                                <tr valign="middle">
                                    <td>
                                        <h4>Products</h4>
                                    </td>
                                    <td align="right" colspan="5">
                                        <button type="submit" class="btn btn-primary submit mb-4" onclick="hideme('addproduct'); populateCategory();">Add New</button>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                    <td class="font-weight-bold" align="center">Product Name</td>
                                    <td class="font-weight-bold" align="center">Price</td>
                                    <td class="font-weight-bold" align="center">Dicsount</td>
                                    <td class="font-weight-bold" colspan="3">Image</td>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            @*                            <tfoot>
                                    <tr>
                                        <th>
                                            Customers
                                        </th>
                                    </tr>
                                </tfoot>
                            *@
                        </table>
                    </div>
                    <div class="col-sm-10 text-left">
                        <div id="addproduct" style="display:none">
                            <div id="default" class="col-sm-10">
                                <form id="frmProduct" method="post">
                                    <table width="100%">
                                        <tr valign="middle">
                                            <td width="50%">
                                                <h4>Add Products</h4>
                                            </td>
                                            <td width="50%" align="right">
                                                <button type="button" class="btn btn-primary" onclick="hideme('defaultdiv'); location.reload();">Cancel</button>
                                                <button type="button" class="btn btn-primary submit mb-4" onclick="PostProduct()">Save</button>
                                            </td>
                                        </tr>
                                    </table>
                                    <div style="width:90%;align-self:center;align-content:center">

                                        <div class="col-md-6 con-left">
                                            <div class="form-group" style="text-align:left">
                                                <label class="my-2">Product Name</label>
                                                <input class="form-control" type="text" name="ProductName" id="ProductName" placeholder="" required="" style="width:500px;">
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label class="my-2">Short Description</label>
                                                <textarea rows="4" cols="200" style="width:500px;" name="ShortDescription" Id="ShortDescription" placeholder="" required=""></textarea>
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label>Full Description </label>
                                                <textarea rows="4" cols="200" style="width:500px;" name="FullDescription" Id="FullDescription" placeholder="" required=""></textarea>
                                            </div>

                                            <div class="form-group" style="text-align:left">
                                                <select class="form-control" name="CategoryId" id="CategoryId">

                                                    <option value="x">Select Category</option>";
                                                </select>
                                                <script>
                                                    function populateCategory() {
                                                        var URL = '@ViewBag.env' + '/api/Products/GetCategories'
                                                        $.ajax({
                                                            url: URL ,
                                                            type: 'GET',

                                                            success: function (result) {
                                                                var markup = "<option value='x'>Select Category</option>";
                                                                var i;
                                                                for (i = 0; i < result.length; i++) {
                                                                    markup += "<option value=" + JSON.stringify(result[i].recId) + ">" + JSON.stringify(result[i].catName) + "</option>";
                                                                }
                                                                $("#CategoryId").html(markup).show();
                                                            },
                                                            error:
                                                                function (result) {
                                                                    alert("error : " + result.responseText);
                                                                }
                                                        });
                                                    }
                                                </script>
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label class="my-2">Price</label>
                                                <input class="form-control" type="text" align="right" name="Price" id="Price" placeholder="" required="" style="width:500px;">
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label class="my-2">Discount</label>
                                                <input class="form-control" type="text" align="right" name="Discount" id="Discount" placeholder="" required="" style="width:500px;">
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                @*                                                <table>
                                                    <tr>
                                                        <td><label class="my-2">Active</label></td>
                                                        <td><input type="checkbox" align="right" name="IsActive" id="IsActive" placeholder="" required="" style="width:500px;" checked></td>
                                                    </tr>
                                                *@                                                    <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="IsActive" name="IsActive" checked>
                                                    <label class="form-check-label" for="exampleCheck1">Active</label>
                                                </div>
                                                @*                                                </table>
                                                *@
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <input class="form-control" type="hidden" name="ProductId" id="ProductId" placeholder="" required="" style="width:500px;">
                                            </div>
                                            <div>

                                            </div>
                                        </div>
                                    </div>

                                    <script>
                                    function PostProduct() {
                                        var ProductName = $('#ProductName').val();
                                        var ShortDescription = $('#ShortDescription').val();
                                        var FullDescription = $('#FullDescription').val();
                                        var Price = $('#Price').val();
                                        var Discount = $('#Discount').val();
                                        var VendorId = '@ViewBag.VendorId';
                                        var CategoryId = $('#CategoryId').val();
                                        var IsActive = $('#IsActive').val();
                                        var myproduct = {
                                            ProductName: ProductName,
                                            ShortDescription: ShortDescription,
                                            FullDescription: FullDescription,
                                            Price: Price,
                                            Discount: Discount,
                                            VendorId: VendorId,
                                            Categoryid: CategoryId,
                                            IsActive: IsActive
                                        }
                                        @*myproduct.append("Categoryid", CategoryId);*@
                                        var URL = '@ViewBag.env' + '/api/Products/PostProduct'
                                        $.ajax({
                                              url: URL,
                                             type: 'POST',
                                             dataType: 'json',
                                             contentType: 'application/json; charset=utf-8',
                                             data: JSON.stringify(myproduct)
                                              , success: function (result) {

                                                  alert("New Product has been added");

                                                  $('#ProductId').val(result.id);
                                                  var x = document.getElementById('PicUpload');
                                                  x.style.display = "Block";


                                           }
                                            , error: function (result) {
                                                alert("error in Product " + result.responseText);
                                            }
                                        })
                                    }
                                    </script>
                                </form>
                            </div>
                            <div class="col-sm-10">
                                <div id="PicUpload" class="border border-warning" style="width:90%;align-self:center;align-content:center;display:none">
                                    <form id="frmPic" method="post" enctype="multipart/form-data">
                                        <span>Select File:</span>
                                        <input type="file" name="myfiles" id="myfiles" multiple />
                                        <input type="button" value="Upload" onclick="PostPicture1(myfiles)" />
                                        <br />
                                        <script>
                                        function PostPicture1(inputId) {
                                            var grid = $("#PicGrid").val();
                                            var input = $('#myfiles').get(0).files;
                                            var formData = new FormData();
                                            var ProductId = $('#ProductId').val();// for pic prod mapping
                                            for (var i = 0; i <= input.length; i++) {
                                                formData.append("file", input[i]);
                                            }
                                            formData.append("Id", ProductId);
                                            var URL = '@ViewBag.env' + '/api/Pictures/PostPicture'
                                            $.ajax({
                                                url: URL,
                                                type: 'POST',
                                                dataType: 'json',
                                                data: formData,
                                                processData: false,
                                                contentType: false,
                                                success: function (result) {
                                                    alert("New Picture has been added"); //this message coming now
                                                    var path = window.location.origin;
                                                    var tablePic = $('#tblpic tbody');
                                                    tablePic.append('<tr><td>' + result.id + '</td><td><img src=' + path + '/ProductImages/' + result.seoFilename + ' height = "75" width = "75" ></td><td>' + result.productId + '</td></tr>');
                                                    //trHTML += '<tr><td><img src=' + path + '/ProductImages/' + item.seoFilename + ' height="75" width="75"></td><td><a href="#" onClick=delpic(' + item.id + ' )>Delete</a></td></tr>';
                                                }
                                                , error: function (result) {
                                                    alert("err " + result.responseText);
                                                }
                                            })
                                        }
                                        </script>
                                        <div id="picGrid">
                                            <table width="100%" id="tblpic" border="1" style="border-color:maroon">
                                                <thead class="bg-primary text-white">
                                                    <tr>
                                                        <th>Id</th>
                                                        <th>Pictures</th>
                                                        <th>ProductId</th>
                                                    <tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                        <div id="editproduct" style="display:none">
                            <div id="default" style="width:99%;align-self:center;align-content:center">
                                <form id="frmProductE" method="post">
                                    <table width="100%">
                                        <tr valign="middle">
                                            <td width="50%">
                                                <h4>Edit Products</h4>
                                            </td>
                                            <td width="50%" align="right">
                                                <button type="button" class="btn btn-primary submit mb-4" onclick="hideme('defaultdiv');">Cancel</button>
                                                <button type="button" class="btn btn-primary submit mb-4" onclick="editproduct1();">Save</button>
                                                <script>
                                                    function editproduct1() {

                                                        var ProductName = $('#ProductNameE').val();
                                                        var ShortDescription = $('#ShortDescriptionE').val();
                                                        var FullDescription = $('#FullDescriptionE').val();
                                                        var Price = parseInt($('#PriceE').val());
                                                        var Discount = parseInt($('#DiscountE').val());
                                                        var VendorId    = parseInt('1007');
                                                        var ProductId = parseInt($('#ProductIdE').val());
                                                        var IsActive = $("#IsActiveE").is(":checked");

                                                        var myproduct = {
                                                            Name: ProductName,
                                                            ShortDescription: ShortDescription,
                                                            FullDescription: FullDescription,
                                                            Price: Price,
                                                            Discount: Discount,
                                                            VendorId: VendorId,
                                                            Id: ProductId,
                                                            IsActive:IsActive
                                                        }
                                                        var URL = '@ViewBag.env' + '/api/Products/PutProduct1'
                                                        $.ajax({
                                                            url: URL ,
                                                            type: 'POST',
                                                            dataType: 'json',
                                                            contentType: 'application/json; charset=utf-8',
                                                            data: JSON.stringify(myproduct)
                                                            , success: function (result) {
                                                                alert(" Product has been edited ");
                                                                $('#ProductIdE').val(result.id);
                                                                location.reload();
                                                            }
                                                            , error: function (result) {
                                                                alert("err " + result.responseText);
                                                            }
                                                        })
                                                    }
                                                </script>
                                            </td>
                                        </tr>
                                    </table>
                                    <div style="width:90%;align-self:center;align-content:center">

                                        <div class="col-md-6 con-left">
                                            <div class="form-group" style="text-align:left">
                                                <input type="hidden" id="ProductIdE" />
                                                <label class="my-2">Product Name</label>
                                                <input class="form-control" type="text" name="ProductNameE" id="ProductNameE" placeholder="" required="" style="width:500px;">
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label class="my-2">Short Description</label>
                                                <textarea rows="4" cols="200" style="width:500px;" name="ShortDescriptionE" Id="ShortDescriptionE" placeholder="" required=""></textarea>
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label>Full Description </label>
                                                <textarea rows="4" cols="200" style="width:500px;" name="FullDescriptionE" Id="FullDescriptionE" placeholder="" required=""></textarea>
                                            </div>

                                            <div class="form-group" style="text-align:left">
                                                <select class="form-control" name="CategoryIdE" id="CategoryIdE">
                                                    <option value="x">Select Category</option>";
                                                    <option value="3">Men -- Clothing</option>
                                                    <option value="6">Women -- Clothing -- Kurti</option>
                                                    <option value="10">Kids -- Boys -- TShirts</option>
                                                    <option value="12">Both Men & Women--Clothing</option>
                                                </select>
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label class="my-2">Price</label>
                                                <input class="form-control" type="text" align="right" name="PriceE" id="PriceE" placeholder="" required="" style="width:500px;">
                                                <input type="hidden" name="CatE" id="CatE">
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <label class="my-2">Discount</label>
                                                <input class="form-control" type="text" align="right" name="DiscountE" id="DiscountE" placeholder="" required="" style="width:500px;">
                                            </div>
                                            <div class="form-group" style="text-align:left">
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="IsActiveE" name="IsActiveE" checked>
                                                    <label class="form-check-label" for="IsActiveE">Active</label>
                                                </div>
                                            </div>

                                            <div class="form-group" style="text-align:left">
                                                <input class="form-control" type="hidden" name="ProductIdE" id="ProductIdE" placeholder="" required="" style="width:500px;">
                                            </div>
                                        </div>
                                        <script>

                                            function EditProduct() {
                                                        var ProductName = $('#ProductNameE').val();
                                                        var ShortDescription = $('#ShortDescriptionE').val();
                                                        var FullDescription = $('#FullDescriptionE').val();
                                                        var Price = parseInt($('#PriceE').val());
                                                        var Discount = parseInt($('#DiscountE').val());
                                                        var VendorId = parseInt('@ViewBag.VendorId');
                                                        var ProductId = parseInt($('#ProductIdE').val());
                                                        var IsActive = parseInt($('#IsActiveE').val());

                                                        var myproduct = {
                                                            Name: ProductName,
                                                            ShortDescription: ShortDescription,
                                                            FullDescription: FullDescription,
                                                            Price: Price,
                                                            Discount: Discount,
                                                            VendorId: VendorId,
                                                            Id: ProductId,
                                                            IsActive=IsActive
                                                }
                                                var URL = '@ViewBag.env' + '/api/Products/PutProduct1'
                                                $.ajax({
                                                    url: URL,
                                                    type: 'POST',
                                                    dataType: 'json',
                                                    contentType: 'application/json; charset=utf-8',
                                                    data: JSON.stringify(myproduct)
                                                    , success: function (result) {
                                                        alert(" Product has been edited ");
                                                        $('#ProductId').val(result.id);
                                                        location.reload();
                                                    }
                                                    , error: function (result) {
                                                        alert("err " + result.responseText);
                                                    }
                                                })
                                                    }
                                        </script>
                                    </div>
                                </form>


                            </div>
                            <div class="col-sm-10">
                                <div id="PicUploadE" class="border border-warning" style="width:80%;align-self:center;align-content:center">
                                    <form id="frmPicE" method="post" enctype="multipart/form-data">

                                        <span>Select File:</span>
                                        <input type="file" name="myfilesE" id="myfilesE" multiple />
                                        <input type="button" value="Upload" onclick="PostPictureE(myfiles)" />
                                        <br />
                                        <script>

                                        function PostPictureE(inputId) {
                                            var grid = $("#PicGrid").val();
                                            var input = $('#myfilesE').get(0).files;
                                            var formData = new FormData();
                                            var ProductId = $('#ProductIdE').val();// for pic prod mapping

                                            for (var i = 0; i <= input.length; i++) {
                                                formData.append("file", input[i]);
                                            }
                                            formData.append("Id", ProductId);
                                            var URL = '@ViewBag.env' + '/api/Pictures/PostPicture'
                                            $.ajax({
                                                url: URL,
                                                type: 'POST',
                                                dataType: 'json',
                                                data: formData,
                                                processData: false,
                                                contentType: false,
                                                success: function (result) {
                                                    alert("Picture has been edited");
                                                    var path = window.location.origin;
                                                    var tablePicE = $('#tblpicE tbody');
                                                    tablePicE.append('<tr><td align="center">' + result.id + '</td><td align="center"><img src=' + path + '/ProductImages/' + result.seoFilename + ' height = "75" width = "75" ></td><td align="center">' + result.productId + '</td><td align="center"><a href="#" onClick=delpic(' + result.id + ' )><img src=' + path + '/Images/delicon.png height = "25" width = "25" ></a></td></tr>');
                                                }
                                                , error: function (result) {
                                                    alert("err " + result.responseText);

                                                }
                                            })
                                        }
                                        function delpicE(PicId) {
                                            var pid = PicId;
                                            var myproduct = {
                                                id: pid
                                            }
                                            var URL = '@ViewBag.env' + '/api/Pictures/DeletePicture1'
                                            $.ajax({
                                                url: URL,
                                                type: 'POST',
                                                dataType: 'json',
                                                contentType: 'application/json; charset=utf-8',
                                                @*data: { "PictureId": pid },*@
                                                data: JSON.stringify(myproduct),
                                                success: function (result) {
                                                    var productid = $('#ProductIdE').val();
                                                    alert('Product picture deleted');
                                                    URL = '@ViewBag.env' + '/api/Pictures/GetProductPicture'
                                                    $.ajax({
                                                        url: URL,
                                                        type: 'GET',
                                                        data: { id: productid },
                                                        success: function (data) {
                                                            var trHTML = '';
                                                            var path = window.location.origin;
                                                            var tbl = document.getElementById("tblpicE");
                                                            for (var i = 0, row; row = tbl.rows[i]; i++) {
                                                                tbl.deleteRow(0);
                                                            }
                                                            var tablePicE = $('#tblpicE tbody');

                                                            $.each(data, function (i, item) {
                                                                tablePicE.append('<tr><td align="center">' + item.id + '</td><td align="center"><img src=' + path + '/ProductImages/' + item.seoFilename + ' height = "75" width = "75" ></td><td align="center">' + item.productId + '</td><td align="center"><a href="#" onClick=delpicE(' + item.id + ' )><img src=' + path + '/Images/delicon.png height = "25" width = "25" ></a></td></tr>');
                                                            });

                                                        }
                                                        , error: function (result) {
                                                            alert("err " + result.responseText);
                                                        }
                                                    })

                                                }
                                                , error: function (result) {
                                                    alert("err " + result.responseText);
                                                }
                                            })

                                        }
                                        function GetProduct(productid) {
                                            var i = 0;
                                            var CatId = 0;
                                            var URL = '@ViewBag.env' + '/api/Products/GetProductWithCat'
                                                        $.ajax({
                                                            url: URL,
                                                            type: 'GET',
                                                            data: { Id: productid },
                                                            success: function (result) {
                                                                var c = document.getElementById('catdiv');
                                                                c.style.display = "none";
                                                                var x = document.getElementById('defaultdiv');
                                                                x.style.display = "none";
                                                                var y = document.getElementById('editproduct');
                                                                y.style.display = "block";
                                                                CatId = result.productCategoryMappings[0].categoryId;
                                                                $('#ProductIdE').val(result.id);
                                                                $('#ProductNameE').val(result.name);
                                                                $('#ShortDescriptionE').val(result.shortDescription);
                                                                $('#FullDescriptionE').val(result.fullDescription);
                                                                $('#PriceE').val(result.price);
                                                                $('#DiscountE').val(result.discount);

                                                                if (result.isActive == true) {
                                                                    $('#IsActiveE').attr('checked', true);
                                                                }
                                                                else {
                                                                    $('#IsActiveE').attr('checked', false);
                                                                }
                                                                URL = '@ViewBag.env' + '/api/Pictures/GetProductPicture'
                                                                $.ajax({
                                                                    url: URL,
                                                                    type: 'GET',
                                                                    data: { id: productid },
                                                                    success: function (data) {

                                                                        var trHTML = '';
                                                                        var path = window.location.origin;
                                                                        //$('#Edpicgrid').html = '';
                                                                        var tablePicE = $('#tblpicE tbody');
                                                                        $.each(data, function (i, item) {
                                                                            var ht = '<tr><td align="center">' + item.id + '</td><td align="center"><img src=' + path + '/ProductImages/' + item.seoFilename + ' height = "75" width = "75" ></td><td align="center">' + item.productId + '</td><td align="center"><a href="#" onClick=delpicE(' + item.id + ')><img src=' + path + '/Images/delicon.png height = "25" width = "25" ></a></td></tr>';
                                                                            //tablePicE.append('<tr><td align="center">' + item.id + '</td><td align="center"><img src=' + path + '/ProductImages/' + item.seoFilename + ' height = "75" width = "75" ></td><td align="center">' + item.productId + '</td><td align="center"><a href="#" onClick=delpicE('+ item.id +')><img src=' + path + '/Images/delicon.png height = "25" width = "25" ></a></td></tr>');
                                                                            tablePicE.append(ht);
                                                                        });
                                                                    }
                                                                    , error: function (result) {
                                                                        alert("err " + result.responseText);
                                                                    }
                                                                })
                                                                var URL = '@ViewBag.env' + '/api/Products/GetCategories'
                                                                $.ajax({
                                                                    url: URL,
                                                                    type: 'GET',

                                                                    success: function (result) {
                                                                        var markup = "<option value='x'>Select Category</option>";
                                                                        var i;
                                                                        for (i = 0; i < result.length; i++) {
                                                                            markup += "<option value=" + JSON.stringify(result[i].recId) + ">" + JSON.stringify(result[i].catName) + "</option>";
                                                                        }
                                                                        $("#CategoryIdE").html(markup).show();
                                                                        $("#CategoryIdE option").each(function () {
                                                                            var value = $(this).attr("value");
                                                                            if (value == CatId) {
                                                                                $(this).attr("selected", true);
                                                                                return false;
                                                                            }
                                                                        });
                                                                    },
                                                                error:
                                                                function (result) {
                                                                    alert("error : " + result.responseText);
                                                                }
                                                            });

                                                        }
                                                        , error: function (result) {
                                                            alert("err " + result.responseText);
                                                        }
                                                    })
                                                    }
                                        function delprod(productid) {
                                                        var Id = productid;
                                                        var myproduct = {
                                                            id: Id
                                            }
                                            var URL = '@ViewBag.env' + '/api/Products/DeleteProduct1/'
                                                        $.ajax({
                                                            url: URL,
                                                            type: 'POST',
                                                            contentType: 'application/json; charset=utf-8',
                                                            data: JSON.stringify(myproduct),

                                                            success: function (result) {
                                                                alert("Product deleted successfully");
                                                                location.reload();
                                                        }
                                                            , error: function (result) {
                                                                var jsonValue = jQuery.parseJSON(result.responseText);
                                                                alert("error in delete product "+jsonValue.Message);
                                                            }
                                                    })
                                                }
                                        function delpic(PicId) {
                                            var URL = '@ViewBag.env' + '/api/Pictures/DeletePicture1/'
                                                    $.ajax({
                                                        url: URL,
                                                        type: 'POST',
                                                        //contentType: 'application/x-www-form-urlencoded',
                                                        data: { PictureId: PicId },
                                                        success: function (result) {
                                                            location.reload();
                                                        }
                                                        , error: function (result) {
                                                            alert("err " + result.responseText);
                                                        }
                                                    })

                                                }
                                        </script>
                                        <div class="col-md-6 con-left">
                                            &nbsp;
                                        </div>
                                    </form>
                                    <div id="EdpicGrid">
                                        <br />
                                        <table width="100%" id="tblpicE" border="1" style="border-color:maroon">
                                            <thead class="bg-primary text-white">
                                                <tr>
                                                    <th align="center">Id</th>
                                                    <th align="center">Pictures</th>
                                                    <th align="center">ProductId</th>
                                                    <th>&nbsp;</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                        <br />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @*<div class="col-sm-2 sidenav">
                    <div class="well">
                        <p>&nbsp;</p>
                    </div>
                    <div class="well">
                        <p>&nbsp;</p>
                    </div>
                </div>*@
        </div>
    </div>

    <footer class="container-fluid text-center">
        <p>Bless Trading Admin</p>
    </footer>

</body>
</html>
